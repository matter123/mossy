#ifndef ARCH_LAPIC_H
#define ARCH_LAPIC_H

void initalize_lapic();

void write_lapic_register(int reg, uint32_t value);
uint32_t read_lapic_register(int reg);

#define LAPIC_ID_REGISTER 0x20

#define LAPIC_TASK_PRIORITY_REGISTER 0x80
#define LAPIC_ARBIRATION_PRIORITY_REGISTER 0x90
#define LAPIC_PROCESSOR_PRIORITY_REGISTER 0xA0
#define LAPIC_EOI_REGISTER 0xB0
#define LAPIC_REMOTE_READ_REGISTER 0xC0
#define LAPIC_LOGICAL_DESTINATION_FORMAT 0xD0
#define LAPIC_DESTINATION_FORMAT_REGISTER 0xE0
#define LAPIC_SPURIOUS_INTERRUPT_VECTOR_REGISTER 0xF0
#define LAPIC_ISR_BITS_31_0 0x100
#define LAPIC_ISR_BITS_63_32 0x110
#define LAPIC_ISR_BITS_95_64 0x120
#define LAPIC_ISR_BITS_127_96 0x130
#define LAPIC_ISR_BITS_159_128 0x140
#define LAPIC_ISR_BITS_191_160 0x150
#define LAPIC_ISR_BITS_223_192 0x160
#define LAPIC_ISR_BITS_255_224 0x170
#define LAPIC_TMR_BITS_31_0 0x180
#define LAPIC_TMR_BITS_63_32 0x190
#define LAPIC_TMR_BITS_95_64 0x1A0
#define LAPIC_TMR_BITS_127_96 0x1B0
#define LAPIC_TMR_BITS_159_128 0x1C0
#define LAPIC_TMR_BITS_191_160 0x1D0
#define LAPIC_TMR_BITS_223_192 0x1E0
#define LAPIC_TMR_BITS_255_224 0x1F0
#define LAPIC_IRR_BITS_31_0 0x200
#define LAPIC_IRR_BITS_63_32 0x210
#define LAPIC_IRR_BITS_95_64 0x220
#define LAPIC_IRR_BITS_127_96 0x230
#define LAPIC_IRR_BITS_159_128 0x240
#define LAPIC_IRR_BITS_191_160 0x250
#define LAPIC_IRR_BITS_223_192 0x260
#define LAPIC_IRR_BITS_255_224 0x270
#define LAPIC_ERROR_STATUS_REGISTER 0x280

#define LAPIC_LVT_CMCI_REGISTER 0x2F0
#define LAPIC_ICR_BITS_31_0 0x300
#define LAPIC_ICR_BITS_63_32 0x310
#define LAPIC_LVT_TIMER_REGISTER 0x320
#define LAPIC_LVT_THERMAL_SENSOR_REGISTER 0x330
#define LAPIC_LVT_PERFMON_COUNTER_REGISTER 0x340
#define LAPIC_LVT_LINT0_REGISTER 0x350
#define LAPIC_LVT_LINT1_REGISTER 0x360
#define LAPIC_LVT_ERROR_REGISTER 0x370
#define LAPIC_INITAL_COUNT_REGISTER 0x380
#define LAPIC_CURRENT_COUNT_REGISTER 0x390

#define LAPIC_DIVIDE_CONFIGURATION_REGISTER 0x3E0

#define LAPIC_TIMER_DIVIDE_1_VALUE 0b1011
#define LAPIC_TIMER_DIVIDE_2_VALUE 0b0000
#define LAPIC_TIMER_DIVIDE_4_VALUE 0b0001
#define LAPIC_TIMER_DIVIDE_8_VALUE 0b0010
#define LAPIC_TIMER_DIVIDE_16_VALUE 0b0011
#define LAPIC_TIMER_DIVIDE_32_VALUE 0b1000
#define LAPIC_TIMER_DIVIDE_64_VALUE 0b1001
#define LAPIC_TIMER_DIVIDE_128_VALUE 0b1010
#define LAPIC_TIMER_MODE_ONE_SHOT 0b00
#define LAPIC_TIMER_MODE_PERIODIC 0b01
#define LAPIC_TIMER_MODE_TSC_DEALINE 0b10
#define LAPIC_TIMER_MODE_DISABLED 0b11

void set_lapic_timer(int mode, int divisor, int vector, uint32_t count);
extern "C" void lapic_eoi();

#endif
